<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facas Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background: url('https://i.pinimg.com/736x/01/22/d9/0122d95177d733f1dabd36acca11fef5.jpg') no-repeat center center fixed;
            background-size: cover;
            color: #fff;
        }
        .input-group-text {
            width: 60px;
        }
        .report-item {
            margin: 10px 0;
        }
    </style>
</head>
<body class="container">
    <div class="row">
        <div class="col-md-4">
            <h2 class="text-center">Entrada de Dados</h2>
            <form id="dataForm">
                <div class="form-group">
                    <label for="dataLancamento">Data do Lançamento</label>
                    <input type="date" id="dataLancamento" class="form-control">
                </div>
                <div class="form-group">
                    <label for="facaSuperiorLR">Faca Superior - LR</label>
                    <input type="number" id="facaSuperiorLR" class="form-control" placeholder="LR">
                </div>
                <div class="form-group">
                    <label for="facaSuperiorM">Faca Superior - M</label>
                    <input type="number" id="facaSuperiorM" class="form-control" placeholder="M">
                </div>
                <div class="form-group">
                    <label for="facaSuperiorLC">Faca Superior - LC</label>
                    <input type="number" id="facaSuperiorLC" class="form-control" placeholder="LC">
                </div>
                <div class="form-group">
                    <label for="facaInferiorLR">Faca Inferior - LR</label>
                    <input type="number" id="facaInferiorLR" class="form-control" placeholder="LR">
                </div>
                <div class="form-group">
                    <label for="facaInferiorM">Faca Inferior - M</label>
                    <input type="number" id="facaInferiorM" class="form-control" placeholder="M">
                </div>
                <div class="form-group">
                    <label for="facaInferiorLC">Faca Inferior - LC</label>
                    <input type="number" id="facaInferiorLC" class="form-control" placeholder="LC">
                </div>
                <button type="button" class="btn btn-primary" onclick="salvarDados()">Salvar</button>
                <button type="button" class="btn btn-danger" onclick="deletarDados()">Deletar</button>
                <div id="successMessage" class="alert alert-success mt-3" style="display:none;"></div>
                <div id="errorMessage" class="alert alert-danger mt-3" style="display:none;"></div>
            </form>
        </div>
        <div class="col-md-4">
            <h2 class="text-center">Gráficos</h2>
            <canvas id="chartFacaSuperior"></canvas>
            <canvas id="chartFacaInferior"></canvas>
        </div>
        <div class="col-md-4">
            <h2 class="text-center">Lançamentos</h2>
            <select id="launchSelector" class="form-control mb-3" onchange="loadDataByLaunch(this.value)">
                <option value="">Selecione um lançamento</option>
            </select>
            <div id="reportContent"></div>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDEsJtoWAUNgStvKg-0mE5CS8qlSLQt7bA",
            authDomain: "myapp2-a3c3f.firebaseapp.com",
            databaseURL: "https://myapp2-a3c3f-default-rtdb.firebaseio.com",
            projectId: "myapp2-a3c3f",
            storageBucket: "myapp2-a3c3f.appspot.com",
            messagingSenderId: "746305842581",
            appId: "1:746305842581:web:0059c0e45f82fd07a01a9c"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const targetValues = {
            superior: { lr: 100, m: 100, lc: 100 },
            inferior: { lr: 100, m: 100, lc: 100 }
        };

        function salvarDados() {
            const dadosFacaSuperior = {
                lr: Number(document.getElementById('facaSuperiorLR').value),
                m: Number(document.getElementById('facaSuperiorM').value),
                lc: Number(document.getElementById('facaSuperiorLC').value)
            };
            const dadosFacaInferior = {
                lr: Number(document.getElementById('facaInferiorLR').value),
                m: Number(document.getElementById('facaInferiorM').value),
                lc: Number(document.getElementById('facaInferiorLC').value)
            };
            const dataLancamento = document.getElementById('dataLancamento').value;

            if (!dataLancamento || !dadosFacaSuperior.lr || !dadosFacaSuperior.m || !dadosFacaSuperior.lc ||
                !dadosFacaInferior.lr || !dadosFacaInferior.m || !dadosFacaInferior.lc) {
                alert('Por favor, preencha todos os campos.');
                return;
            }

            const newLaunchKey = database.ref().child('facas').push().key;
            const updates = {};

            updates[`facas/${newLaunchKey}/superior`] = dadosFacaSuperior;
            updates[`facas/${newLaunchKey}/inferior`] = dadosFacaInferior;
            updates[`facas/${newLaunchKey}/data`] = dataLancamento;

            database.ref().update(updates)
                .then(() => {
                    loadAllLaunches();
                    document.getElementById('successMessage').innerText = 'Dados salvos com sucesso!';
                    document.getElementById('successMessage').style.display = 'block';
                    setTimeout(() => document.getElementById('successMessage').style.display = 'none', 3000);
                })
                .catch((error) => {
                    console.error('Erro ao salvar dados:', error);
                    document.getElementById('errorMessage').style.display = 'block';
                    setTimeout(() => document.getElementById('errorMessage').style.display = 'none', 3000);
                });
        }

        function deletarDados() {
            const selectedLaunch = document.getElementById('launchSelector').value;

            if (!selectedLaunch) {
                alert('Por favor, selecione um lançamento.');
                return;
            }

            database.ref(`facas/${selectedLaunch}`).remove()
                .then(() => {
                    loadAllLaunches();
                    document.getElementById('successMessage').innerText = 'Lançamento deletado com sucesso!';
                    document.getElementById('successMessage').style.display = 'block';
                    setTimeout(() => document.getElementById('successMessage').style.display = 'none', 3000);
                })
                .catch((error) => {
                    console.error('Erro ao deletar dados:', error);
                    document.getElementById('errorMessage').style.display = 'block';
                    setTimeout(() => document.getElementById('errorMessage').style.display = 'none', 3000);
                });
        }

        function loadAllLaunches() {
            const launchSelector = document.getElementById('launchSelector');
            launchSelector.innerHTML = '<option value="">Selecione um lançamento</option>';

            database.ref('facas').once('value', (snapshot) => {
                const data = snapshot.val() || {};
                Object.keys(data).forEach(launchKey => {
                    const option = document.createElement('option');
                    const date = data[launchKey].data;
                    option.value = launchKey;
                    option.textContent = `Lançamento ${Object.keys(data).indexOf(launchKey) + 1} - ${date}`;
                    launchSelector.appendChild(option);
                });
            });
        }

        function loadDataByLaunch(launchKey) {
            if (!launchKey) return;

            database.ref(`facas/${launchKey}`).once('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    updateChart(chartFacaSuperior, data.superior, targetValues.superior, 'Faca Superior');
                    updateChart(chartFacaInferior, data.inferior, targetValues.inferior, 'Faca Inferior');
                }
            });
        }

        function updateChart(chart, data, target, label) {
            const percentages = {
                lr: (data.lr / target.lr) * 100,
                m: (data.m / target.m) * 100,
                lc: (data.lc / target.lc) * 100
            };

            chart.data.datasets[0].data = [percentages.lr, percentages.m, percentages.lc];
            chart.update();
        }

        document.addEventListener('DOMContentLoaded', () => {
            const ctxFacaSuperior = document.getElementById('chartFacaSuperior').getContext('2d');
            const ctxFacaInferior = document.getElementById('chartFacaInferior').getContext('2d');

            window.chartFacaSuperior = new Chart(ctxFacaSuperior, {
                type: 'bar',
                data: {
                    labels: ['LR', 'M', 'LC'],
                    datasets: [{
                        label: 'Faca Superior',
                        data: [],
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: (value) => value + '%'
                            }
                        }
                    },
                    plugins: {
                        datalabels: {
                            formatter: (value) => value.toFixed(1) + '%'
                        }
                    }
                }
            });

            window.chartFacaInferior = new Chart(ctxFacaInferior, {
                type: 'bar',
                data: {
                    labels: ['LR', 'M', 'LC'],
                    datasets: [{
                        label: 'Faca Inferior',
                        data: [],
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: (value) => value + '%'
                            }
                        }
                    },
                    plugins: {
                        datalabels: {
                            formatter: (value) => value.toFixed(1) + '%'
                        }
                    }
                }
            });

            loadAllLaunches();
        });
    </script>
</body>
</html>
