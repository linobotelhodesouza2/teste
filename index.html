<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráficos de Facas</title>
    <style>
        body {
            background-image: url('https://i.pinimg.com/736x/01/22/d9/0122d95177d733f1dabd36acca11fef5.jpg');
            background-size: cover;
            color: #fff;
            font-family: Arial, sans-serif;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .chart-container {
            width: 90%;
            max-width: 600px;
            margin: 20px 0;
        }
        #reportContent {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            width: 90%;
            max-width: 600px;
        }
        .report-item {
            margin-bottom: 10px;
        }
        .input-container {
            width: 90%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .input-container label {
            margin-bottom: 5px;
        }
        .input-container input {
            padding: 10px;
            border: none;
            border-radius: 5px;
        }
        #successMessage, #errorMessage {
            display: none;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
        }
        #successMessage {
            background: rgba(0, 128, 0, 0.5);
        }
        #errorMessage {
            background: rgba(128, 0, 0, 0.5);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://www.gstatic.com/firebasejs/9.9.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.9.3/firebase-database.js"></script>
</head>
<body>
    <h1>Gráficos de Facas</h1>
    
    <div class="input-container">
        <label for="dataLancamento">Data de Lançamento</label>
        <input type="date" id="dataLancamento" required>
        <label for="lrSuperior">L.R Superior</label>
        <input type="number" id="lrSuperior" placeholder="68.5">
        <label for="mSuperior">M Superior</label>
        <input type="number" id="mSuperior" placeholder="69">
        <label for="lcSuperior">L.C Superior</label>
        <input type="number" id="lcSuperior" placeholder="68.9">
        <label for="lrInferior">L.R Inferior</label>
        <input type="number" id="lrInferior" placeholder="65">
        <label for="mInferior">M Inferior</label>
        <input type="number" id="mInferior" placeholder="65">
        <label for="lcInferior">L.C Inferior</label>
        <input type="number" id="lcInferior" placeholder="65">
        <button onclick="salvarDados()">Salvar</button>
        <button onclick="deletarDados()">Deletar</button>
    </div>

    <div class="chart-container">
        <canvas id="chartFacaSuperior"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="chartFacaInferior"></canvas>
    </div>

    <div id="reportContent"></div>

    <div id="successMessage">Dados salvos com sucesso!</div>
    <div id="errorMessage">Erro ao salvar dados!</div>

    <select id="launchSelector" onchange="loadDataByLaunch(this.value)">
        <option value="">Selecione um lançamento</option>
    </select>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDEsJtoWAUNgStvKg-0mE5CS8qlSLQt7bA",
            authDomain: "myapp2-a3c3f.firebaseapp.com",
            databaseURL: "https://myapp2-a3c3f-default-rtdb.firebaseio.com",
            projectId: "myapp2-a3c3f",
            storageBucket: "myapp2-a3c3f.appspot.com",
            messagingSenderId: "746305842581",
            appId: "1:746305842581:web:0059c0e45f82fd07a01a9c"
        };

        // Inicializando o Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database(app);

        const targetValues = {
            superior: { lr: 68.5, m: 69, lc: 68.9 },
            inferior: { lr: 65, m: 65, lc: 65 }
        };

        function salvarDados() {
            const lrSuperior = parseFloat(document.getElementById('lrSuperior').value) || targetValues.superior.lr;
            const mSuperior = parseFloat(document.getElementById('mSuperior').value) || targetValues.superior.m;
            const lcSuperior = parseFloat(document.getElementById('lcSuperior').value) || targetValues.superior.lc;
            const lrInferior = parseFloat(document.getElementById('lrInferior').value) || targetValues.inferior.lr;
            const mInferior = parseFloat(document.getElementById('mInferior').value) || targetValues.inferior.m;
            const lcInferior = parseFloat(document.getElementById('lcInferior').value) || targetValues.inferior.lc;
            const dataLancamento = document.getElementById('dataLancamento').value;

            const dadosFacaSuperior = { lr: lrSuperior, m: mSuperior, lc: lcSuperior };
            const dadosFacaInferior = { lr: lrInferior, m: mInferior, lc: lcInferior };

            const newLaunchKey = database.ref().child('facas').push().key;
            const updates = {};

            updates[`facas/${newLaunchKey}/superior`] = dadosFacaSuperior;
            updates[`facas/${newLaunchKey}/inferior`] = dadosFacaInferior;
            updates[`facas/${newLaunchKey}/data`] = dataLancamento;

            database.ref().update(updates)
                .then(() => {
                    loadAllLaunches();
                    document.getElementById('successMessage').innerText = 'Dados salvos com sucesso!';
                    document.getElementById('successMessage').style.display = 'block';
                    setTimeout(() => document.getElementById('successMessage').style.display = 'none', 3000);
                })
                .catch((error) => {
                    console.error('Erro ao salvar dados:', error);
                    document.getElementById('errorMessage').style.display = 'block';
                    setTimeout(() => document.getElementById('errorMessage').style.display = 'none', 3000);
                });
        }

        function deletarDados() {
            const selectedLaunch = document.getElementById('launchSelector').value;

            if (!selectedLaunch) {
                alert('Por favor, selecione um lançamento.');
                return;
            }

            database.ref(`facas/${selectedLaunch}`).remove()
                .then(() => {
                    loadAllLaunches();
                    document.getElementById('successMessage').innerText = 'Lançamento deletado com sucesso!';
                    document.getElementById('successMessage').style.display = 'block';
                    setTimeout(() => document.getElementById('successMessage').style.display = 'none', 3000);
                })
                .catch((error) => {
                    console.error('Erro ao deletar dados:', error);
                    document.getElementById('errorMessage').style.display = 'block';
                    setTimeout(() => document.getElementById('errorMessage').style.display = 'none', 3000);
                });
        }

        function loadAllLaunches() {
            const launchSelector = document.getElementById('launchSelector');
            launchSelector.innerHTML = '<option value="">Selecione um lançamento</option>'; // Limpar opções anteriores

            database.ref('facas').once('value', (snapshot) => {
                const data = snapshot.val() || {};
                Object.keys(data).forEach(launchKey => {
                    const option = document.createElement('option');
                    const date = data[launchKey].data;
                    option.value = launchKey;
                    option.textContent = `Lançamento ${Object.keys(data).indexOf(launchKey) + 1} - ${date}`;
                    launchSelector.appendChild(option);
                });
            });
        }

        function loadDataByLaunch(launchKey) {
            if (!launchKey) return;

            database.ref(`facas/${launchKey}`).once('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    updateCharts(data.superior, data.inferior);
                }
            });
        }

        function updateCharts(dadosFacaSuperior, dadosFacaInferior) {
            // Dados da faca superior
            const superiorData = {
                labels: ['L.R Superior', 'M Superior', 'L.C Superior'],
                datasets: [{
                    label: 'Faca Superior',
                    data: [dadosFacaSuperior.lr, dadosFacaSuperior.m, dadosFacaSuperior.lc],
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            };

            // Dados da faca inferior
            const inferiorData = {
                labels: ['L.R Inferior', 'M Inferior', 'L.C Inferior'],
                datasets: [{
                    label: 'Faca Inferior',
                    data: [dadosFacaInferior.lr, dadosFacaInferior.m, dadosFacaInferior.lc],
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            };

            // Configuração do gráfico da faca superior
            const configSuperior = {
                type: 'bar',
                data: superiorData,
                options: {
                    responsive: true,
                    plugins: {
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            formatter: (value, context) => {
                                const label = context.chart.data.labels[context.dataIndex];
                                if (label === 'L.R Superior') return `${value} (68.5 LR)`;
                                if (label === 'M Superior') return `${value} (69 M)`;
                                if (label === 'L.C Superior') return `${value} (68.9 LC)`;
                                return value;
                            }
                        }
                    }
                }
            };

            // Configuração do gráfico da faca inferior
            const configInferior = {
                type: 'bar',
                data: inferiorData,
                options: {
                    responsive: true,
                    plugins: {
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            formatter: (value, context) => {
                                const label = context.chart.data.labels[context.dataIndex];
                                if (label === 'L.R Inferior') return `${value} (65 LR)`;
                                if (label === 'M Inferior') return `${value} (65 M)`;
                                if (label === 'L.C Inferior') return `${value} (65 LC)`;
                                return value;
                            }
                        }
                    }
                }
            };

            // Renderizar os gráficos
            const chartFacaSuperior = new Chart(document.getElementById('chartFacaSuperior'), configSuperior);
            const chartFacaInferior = new Chart(document.getElementById('chartFacaInferior'), configInferior);
        }

        // Carregar todos os lançamentos ao iniciar a página
        window.onload = loadAllLaunches;
    </script>
</body>
</html>
