<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Régua de Lâmina com Gráfico</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
        }

        .form-container {
            margin-bottom: 20px;
        }

        form {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        label, input {
            margin-right: 10px;
        }

        input {
            width: 50px; /* Pequeno o suficiente para 3 números */
            text-align: center;
        }

        .ruler {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 80%;
            height: 50px; /* Altura da lâmina */
            background-color: #f0f0f0; /* Cor da lâmina */
            border: 2px solid #000; /* Borda da lâmina */
            position: relative;
            margin-bottom: 20px; /* Espaçamento entre a lâmina e o gráfico */
        }

        .ruler div {
            width: 30%;
            text-align: center;
            padding: 5px;
            border: 1px solid #000;
            background-color: #d9d9d9; /* Cor das divisões */
            position: absolute;
        }

        .lc {
            left: 0;
        }

        .m {
            left: 50%;
            transform: translateX(-50%);
        }

        .lr {
            right: 0;
        }

        .chart-container {
            width: 80%;
            margin-top: 10px; /* Ajusta o espaço entre o gráfico e o formulário */
        }

        .save-button {
            margin-top: 20px;
        }

        .history-container {
            margin-top: 30px;
            width: 80%;
            display: flex;
            flex-direction: column;
        }

        .history-dropdown {
            width: 100%;
            padding: 10px;
        }

        .history-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-top: 10px; /* Ajusta o espaço entre os dados e o gráfico */
        }

        .history-info {
            width: 50%;
        }

        .history-chart {
            width: 50%;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-database-compat.js"></script>
</head>
<body>
    <div class="form-container">
        <form id="laminaForm">
            <label for="lc">LC:</label>
            <input type="number" id="lc" name="lc" maxlength="3">
            <label for="m">M:</label>
            <input type="number" id="m" name="m" maxlength="3">
            <label for="lr">LR:</label>
            <input type="number" id="lr" name="lr" maxlength="3">
            <button type="button" onclick="updateRuler()">Inserir</button>
        </form>
    </div>
    <div class="ruler">
        <div class="lc" id="lcDisplay"></div>
        <div class="m" id="mDisplay"></div>
        <div class="lr" id="lrDisplay"></div>
    </div>
    <div class="chart-container">
        <canvas id="percentageChart"></canvas>
    </div>
    <button class="save-button" onclick="saveToFirebase()">Salvar no Firebase</button>

    <div class="history-container">
        <select class="history-dropdown" id="historyDropdown" onchange="loadHistory(this.value)">
            <option value="">Selecione uma data</option>
        </select>
        <div class="history-display" id="historyDisplay">
            <div class="history-info" id="historyInfo"></div>
            <div class="history-chart">
                <canvas id="historyChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDEsJtoWAUNgStvKg-0mE5CS8qlSLQt7bA",
            authDomain: "myapp2-a3c3f.firebaseapp.com",
            databaseURL: "https://myapp2-a3c3f-default-rtdb.firebaseio.com",
            projectId: "myapp2-a3c3f",
            storageBucket: "myapp2-a3c3f.appspot.com",
            messagingSenderId: "746305842581",
            appId: "1:746305842581:web:0059c0e45f82fd07a01a9c"
        };

        // Inicializando Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        function updateRuler() {
            const lcValue = parseFloat(document.getElementById('lc').value) || 0;
            const mValue = parseFloat(document.getElementById('m').value) || 0;
            const lrValue = parseFloat(document.getElementById('lr').value) || 0;

            const total = lcValue + mValue + lrValue;
            const lcPercent = total ? (lcValue / total) * 100 : 0;
            const mPercent = total ? (mValue / total) * 100 : 0;
            const lrPercent = total ? (lrValue / total) * 100 : 0;

            document.getElementById('lcDisplay').innerText = lcValue;
            document.getElementById('mDisplay').innerText = mValue;
            document.getElementById('lrDisplay').innerText = lrValue;

            updateChart([lcPercent, mPercent, lrPercent]);
        }

        let chart;

        function updateChart(data) {
            const ctx = document.getElementById('percentageChart').getContext('2d');
            if (chart) {
                chart.data.datasets[0].data = data;
                chart.update();
            } else {
                chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['LC', 'M', 'LR'],
                        datasets: [{
                            data: data,
                            backgroundColor: ['rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)', 'rgba(75, 192, 192, 0.2)'],
                            borderColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)', 'rgba(75, 192, 192, 1)'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        plugins: {
                            datalabels: {
                                anchor: 'end',
                                align: 'top',
                                formatter: (value) => `${value.toFixed(2)}%`,
                                font: {
                                    weight: 'bold'
                                }
                            }
                        },
                        scales: {
                            y: {
                                display: false,
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    },
                    plugins: [ChartDataLabels]
                });
            }
        }

        function saveToFirebase() {
            const lcValue = parseFloat(document.getElementById('lc').value) || 0;
            const mValue = parseFloat(document.getElementById('m').value) || 0;
            const lrValue = parseFloat(document.getElementById('lr').value) || 0;

            const data = {
                lc: lcValue,
                m: mValue,
                lr: lrValue,
                timestamp: Date.now()
            };

            database.ref('laminaData').push(data)
                .then(() => {
                    alert('Dados salvos com sucesso no Firebase!');
                    loadHistoryDropdown();
                })
                .catch((error) => {
                    console.error('Erro ao salvar dados no Firebase:', error);
                });
        }

        function loadHistoryDropdown() {
            const dropdown = document.getElementById('historyDropdown');
            dropdown.innerHTML = '<option value="">Selecione uma data</option>';

            database.ref('laminaData').once('value', (snapshot) => {
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    const date = new Date(data.timestamp);
                    const dateString = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();

                    const option = document.createElement('option');
                    option.value = childSnapshot.key;
                    option.textContent = dateString;

                    dropdown.appendChild(option);
                });
            });
        }

        let historyChart;

        function loadHistory(key) {
            if (!key) return;

            database.ref(`laminaData/${key}`).once('value', (snapshot) => {
                const data = snapshot.val();
                const lcPercent = (data.lc / (data.lc + data.m + data.lr)) * 100;
                const mPercent = (data.m / (data.lc + data.m + data.lr)) * 100;
                const lrPercent = (data.lr / (data.lc + data.m + data.lr)) * 100;

                const historyInfo = document.getElementById('historyInfo');
                historyInfo.innerHTML = `
                    <p><strong>LC:</strong> ${data.lc}</p>
                    <p><strong>M:</strong> ${data.m}</p>
                    <p><strong>LR:</strong> ${data.lr}</p>
                `;

                const ctx = document.getElementById('historyChart').getContext('2d');
                if (historyChart) {
                    historyChart.data.datasets[0].data = [lcPercent, mPercent, lrPercent];
                    historyChart.update();
                } else {
                    historyChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['LC', 'M', 'LR'],
                            datasets: [{
                                data: [lcPercent, mPercent, lrPercent],
                                backgroundColor: ['rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)', 'rgba(75, 192, 192, 0.2)'],
                                borderColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)', 'rgba(75, 192, 192, 1)'],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            plugins: {
                                datalabels: {
                                    anchor: 'end',
                                    align: 'top',
                                    formatter: (value) => `${value.toFixed(2)}%`,
                                    font: {
                                        weight: 'bold'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    display: false,
                                    beginAtZero: true,
                                    max: 100
                                }
                            }
                        },
                        plugins: [ChartDataLabels]
                    });
                }
            });
        }

        // Carregar o dropdown ao carregar a página
        window.onload = loadHistoryDropdown;
    </script>
</body>
</html>
